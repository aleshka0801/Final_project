import pandas as pd

def загрузить_элементы_из_excel(имя_файла):
    """Загружает элементы и их атомные массы из Excel-файла"""
    try:
        df = pd.read_excel(имя_файла)
        return dict(zip(df['A'], df['B']))
    except Exception as e:
        print(f"Ошибка загрузки файла: {e}")
        return None

# Загрузка элементов (обязательно из файла)
элементы = загрузить_элементы_из_excel('atomicmass.xlsx')
if элементы is None:
    print("Ошибка: не удалось загрузить данные об элементах!")
    exit()

def разобрать_формулу(формула):
    """Разбирает химическую формулу на элементы и их количество"""
    элементы_в_формуле = {}
    текущий_элемент = ""
    количество = ""

    for символ in формула:
        if символ.isupper():
            if текущий_элемент:
                элементы_в_формуле[текущий_элемент] = элементы_в_формуле.get(текущий_элемент, 0) + (
                    int(количество) if количество else 1)
            текущий_элемент = символ
            количество = ""
        elif символ.islower():
            текущий_элемент += символ
        elif символ.isdigit():
            количество += символ

    if текущий_элемент:
        элементы_в_формуле[текущий_элемент] = элементы_в_формуле.get(текущий_элемент, 0) + (
            int(количество) if количество else 1)

    return элементы_в_формуле

def рассчитать_массу(формула):
    """Вычисляет молярную массу вещества"""
    элементы_в_веществе = разобрать_формулу(формула)
    общая_масса = 0

    for элемент, число_атомов in элементы_в_веществе.items():
        if элемент in элементы:
            общая_масса += элементы[элемент] * число_атомов
        else:
            print(f"Ошибка: элемент {элемент} не найден!")
            return None

    return общая_масса

def рассчитать_моли():
    """Вычисляет количество молей по массе вещества"""
    формула = input("Введите формулу вещества: ")
    масса_вещества = float(input("Введите массу вещества в граммах: "))

    молярная_масса = рассчитать_массу(формула)
    if молярная_масса is None:
        return

    моли = масса_вещества / молярная_масса
    print(f"Количество молей: {моли:.4f} моль")

def показать_элементы():
    """Показывает список всех элементов из файла"""
    print("\nСписок всех элементов:")
    df = pd.DataFrame({'Элемент': элементы.keys(), 'Масса': элементы.values()})
    for i in range(0, len(df), 8):
        print(" | ".join(f"{row['Элемент']}: {row['Масса']}" for _, row in df.iloc[i:i+8].iterrows()))
    print()

# Основная программа
print("★ Химический калькулятор ★")
print("Функции программы:")
print("1 - Найти молярную массу вещества")
print("2 - Рассчитать количество молей")
print("3 - Показать таблицу элементов")
print("0 - Выйти из программы")

while True:
    выбор = input("\nВыберите действие (1/2/3/0): ")

    if выбор == "1":
        формула = input("Введите химическую формулу: ")
        масса = рассчитать_массу(формула)
        if масса:
            print(f"Молярная масса {формула} = {масса:.3f} г/моль")
    elif выбор == "2":
        рассчитать_моли()
    elif выбор == "3":
        показать_элементы()
    elif выбор == "0":
        print("До свидания!")
        break
    else:
        print("Неверный выбор. Попробуйте снова.")